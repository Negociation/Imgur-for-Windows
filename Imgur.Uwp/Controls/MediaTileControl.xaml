<UserControl
    x:Class="Imgur.Uwp.Controls.MediaTileControl"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:winui="using:Microsoft.UI.Xaml.Controls"
    xmlns:toolkit="using:Microsoft.Toolkit.Uwp.UI.Controls"
    xmlns:Windows10version1809="http://schemas.microsoft.com/winfx/2006/xaml/presentation?IsApiContractPresent(Windows.Foundation.UniversalApiContract, 7)"
    xmlns:contract5Present="http://schemas.microsoft.com/winfx/2006/xaml/presentation?IsApiContractPresent(Windows.Foundation.UniversalApiContract,5)"
    xmlns:Interactivity="using:Microsoft.Xaml.Interactivity"
    xmlns:Core="using:Microsoft.Xaml.Interactions.Core"
    xmlns:local1="using:Imgur.Uwp.TemplateSelectors"
    xmlns:models="using:Imgur.Models"
    xmlns:controls="using:Imgur.Uwp.Controls"
    mc:Ignorable="d"
    d:DesignHeight="300"
    d:DesignWidth="400"
    HorizontalAlignment="Stretch"
    VerticalAlignment="Stretch">
    <UserControl.Resources>

        <!-- DEFAULT IMAGE TEMPLATE -->
        <DataTemplate x:Key="ImageTemplate" x:DataType="models:Media">
            <Grid Background="#474a51" HorizontalAlignment="Stretch" VerticalAlignment="Stretch" Windows10version1809:CornerRadius="5">
                <Grid.RowDefinitions>
                    <RowDefinition  />
                    <RowDefinition MaxHeight="90"  />
                </Grid.RowDefinitions>

                <!-- Loading -->
                <ProgressRing x:Name="LoadingRing" VerticalAlignment="Center" Grid.RowSpan="2" Width="50" Height="50" IsActive="True"  />
                <FontIcon  Grid.RowSpan="2" FontFamily="{StaticResource SegoeMDLGlyphs}" FontSize="25" Foreground="#01b96b"  Glyph="&#xE91B;"/>

                <!-- Data Container -->
                <Grid x:Name="mediaContainer" Grid.RowSpan="2">
                    <Image x:Name="mediaThumb" Stretch="UniformToFill"  Visibility="Visible" Source="{Binding CoverImage,Mode=OneWay}" />
                </Grid>

                <StackPanel x:Name="mediaInfoContainer" Orientation="Horizontal" VerticalAlignment="Top" Opacity="0.9" HorizontalAlignment="Right" Margin="15" Grid.Row="0">
                    <Grid x:Name="AlbumCountContainer" HorizontalAlignment="Right"  Margin="5,0,0,0" Background="#2e3035" Padding="5,0,5,0" Height="22" CornerRadius="3"  Visibility="{Binding IsAlbum}">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="auto" />
                            <ColumnDefinition Width="*" />
                        </Grid.ColumnDefinitions>
                        <FontIcon Grid.Column="0" Margin="0,0,0,0" FontFamily="{StaticResource FluentUIGlyphs}"  FontWeight="Black" FontSize="16" Glyph="&#xE8B9;"/>
                        <TextBlock Grid.Column="1" TextAlignment="Center" VerticalAlignment="Center" Margin="5,-1,0,0" Text="{Binding ImagesCount,FallbackValue=0,Mode=OneWay}" FontSize="12" FontWeight="Bold" />
                    </Grid>
                </StackPanel>
                <Grid Grid.Row="1" x:Name="MediaFooter" Background="{StaticResource AcrylicInAppFillColorDefaultBrush}"  RequestedTheme="Dark" Margin="-1" contract5Present:CornerRadius="0,0,5,5" Opacity="0.9">
                    <Grid Grid.Row="2" Margin="0,0,0,0" Padding="10">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="40"  />
                            <RowDefinition Height="*" />
                        </Grid.RowDefinitions>
                        <TextBlock Grid.Row="0" Margin="10,0,10,0" TextWrapping="Wrap" TextTrimming="CharacterEllipsis" ToolTipService.ToolTip="{Binding  Title,Mode=OneWay}" FontWeight="SemiBold"  Text="{Binding Title,FallbackValue='Image Title',Mode=OneWay }"/>
                        <Grid Grid.Row="1" >
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="*" />
                            </Grid.ColumnDefinitions>
                            <StackPanel HorizontalAlignment="Left" Margin="15,0,0,0" Grid.Column="0" Orientation="Horizontal">
                                <FontIcon FontFamily="{StaticResource FluentUIGlyphs}"  VerticalAlignment="Center" FontSize="12" Glyph="&#xE74A;"/>
                                <TextBlock FontSize="12" TextAlignment="End" Margin="10,7,0,0" Text="{Binding Ups,FallbackValue=0,Mode=OneWay}"/>
                            </StackPanel>

                            <StackPanel HorizontalAlignment="Center" Grid.Column="1" Orientation="Horizontal">
                                <FontIcon FontFamily="{StaticResource SegoeMDLGlyphs}"  VerticalAlignment="Center" FontSize="12" Glyph="&#xE90A;"/>
                                <TextBlock FontSize="12" Margin="10,5,0,0" Text="{Binding CommentCount,Converter={StaticResource KiloConverter},FallbackValue=0,Mode=OneWay}"/>
                            </StackPanel>

                            <StackPanel HorizontalAlignment="Right" Margin="0,0,15,0" Grid.Column="2" Orientation="Horizontal">
                                <FontIcon FontFamily="{StaticResource FluentUIGlyphs}"  FontSize="12" VerticalAlignment="Center" Glyph="&#xE890;"/>
                                <TextBlock FontSize="12" Margin="10,5,0,0" Text="{Binding Views,Converter={StaticResource KiloConverter},FallbackValue=0,Mode=OneWay}"/>
                            </StackPanel>
                        </Grid>
                    </Grid>
                </Grid>
                <Border  BorderThickness="6" Grid.RowSpan="2" Visibility="Collapsed" Windows10version1809:CornerRadius="5">
                    <Border.BorderBrush>
                        <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                            <GradientStop Offset="0" Color="#69d8ca"/>
                            <GradientStop Offset="0.5" Color="#3592ff"/>
                            <GradientStop Offset="1" Color="#9c31ff"/>
                        </LinearGradientBrush>
                    </Border.BorderBrush>
                </Border>
            </Grid>
        </DataTemplate>

        <!-- GIF TEMPLATE -->
        <DataTemplate x:Key="GifTemplate" x:DataType="models:Media" >
            <Grid Background="#474a51" HorizontalAlignment="Stretch" VerticalAlignment="Stretch" Windows10version1809:CornerRadius="5"  ContextRequested="Media_ContextRequested">
                <Grid.RowDefinitions>
                    <RowDefinition  />
                    <RowDefinition MaxHeight="90"  />
                </Grid.RowDefinitions>

                <!-- Loading -->
                <ProgressRing x:Name="LoadingRing" VerticalAlignment="Center" Margin="0,0,0,0" Grid.RowSpan="2" Width="50" Height="50" IsActive="True"  />
                <FontIcon  Grid.RowSpan="2" FontFamily="{StaticResource SegoeMDLGlyphs}" FontSize="25" Foreground="#01b96b"  Glyph="&#xE91B;"/>

                <!-- Data Container -->
                <Grid x:Name="mediaContainer" Grid.RowSpan="2">
                    <Grid x:Name="gifPlaceholderContainer">
                        <Image x:Name="mediaPlaceholderImage" Stretch="UniformToFill" Source="{Binding CoverPlaceholder,Mode=OneWay}"/>
                        <Grid Background="Black" Opacity="1">
                            <winui:ProgressBar  x:Name="LoadingBar" MinHeight="4" IsEnabled="True" IsIndeterminate="True" VerticalAlignment="Top" Margin="0,0,0,0" />
                        </Grid>
                    </Grid>
                    <Image x:Name="mediaThumb" Stretch="UniformToFill"  Visibility="Visible" Source="{Binding CoverImage,Mode=OneWay}" />
                </Grid>
                <StackPanel x:Name="mediaInfoContainer" Orientation="Horizontal" VerticalAlignment="Top" Opacity="0.9" HorizontalAlignment="Right" Margin="15" Grid.Row="0">
                    <Grid x:Name="GifCountContainer" HorizontalAlignment="Right"  Margin="0,0,0,0" Background="#2e3035" Padding="5,0,5,0" Height="22"  CornerRadius="3">
                        <TextBlock TextAlignment="Center" VerticalAlignment="Center" Margin="0,0,0,0" Text="GIF" FontSize="10" FontWeight="Black"></TextBlock>
                    </Grid>
                    <Grid x:Name="AlbumCountContainer" HorizontalAlignment="Right"  Margin="5,0,0,0" Background="#2e3035" Padding="5,0,5,0" Height="22" CornerRadius="3" Visibility="{Binding IsAlbum}">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="auto" />
                            <ColumnDefinition Width="*" />
                        </Grid.ColumnDefinitions>
                        <FontIcon Grid.Column="0" Margin="0,0,0,0" FontFamily="{StaticResource FluentUIGlyphs}"  FontWeight="Black" FontSize="16" Glyph="&#xE8B9;"/>
                        <TextBlock Grid.Column="1" TextAlignment="Center" VerticalAlignment="Center" Margin="5,-1,0,0" Text="{Binding ImagesCount,FallbackValue=0,Mode=OneWay}" FontSize="12" FontWeight="Bold" />
                    </Grid>
                </StackPanel>
                <Grid Grid.Row="1" x:Name="MediaFooter" Background="{StaticResource AcrylicInAppFillColorDefaultBrush}"  RequestedTheme="Dark" Margin="-1" contract5Present:CornerRadius="0,0,5,5" Opacity="0.9">
                    <Grid Grid.Row="2" Margin="0,0,0,0" Padding="10">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="40"  />
                            <RowDefinition Height="*" />
                        </Grid.RowDefinitions>
                        <TextBlock Grid.Row="0" Margin="10,0,10,0" TextWrapping="Wrap" TextTrimming="CharacterEllipsis" FontWeight="SemiBold" ToolTipService.ToolTip="{Binding  Title,Mode=OneWay}"  Text="{Binding Title,FallbackValue='Image Title',Mode=OneWay }"/>
                        <Grid Grid.Row="1" >
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="*" />
                            </Grid.ColumnDefinitions>
                            <StackPanel HorizontalAlignment="Left" Margin="15,0,0,0" Grid.Column="0" Orientation="Horizontal">
                                <FontIcon FontFamily="{StaticResource FluentUIGlyphs}"  VerticalAlignment="Center" FontSize="12" Glyph="&#xE74A;"/>
                                <TextBlock FontSize="12" TextAlignment="End" Margin="10,7,0,0" Text="{Binding Ups,FallbackValue=0,Mode=OneWay}"/>
                            </StackPanel>

                            <StackPanel HorizontalAlignment="Center" Grid.Column="1" Orientation="Horizontal">
                                <FontIcon FontFamily="{StaticResource SegoeMDLGlyphs}"  VerticalAlignment="Center" FontSize="12" Glyph="&#xE90A;"/>
                                <TextBlock FontSize="12" Margin="10,5,0,0" Text="{Binding CommentCount,Converter={StaticResource KiloConverter},FallbackValue=0,Mode=OneWay}"/>
                            </StackPanel>

                            <StackPanel HorizontalAlignment="Right" Margin="0,0,15,0" Grid.Column="2" Orientation="Horizontal">
                                <FontIcon FontFamily="{StaticResource FluentUIGlyphs}"  FontSize="12" VerticalAlignment="Center" Glyph="&#xE890;"/>
                                <TextBlock FontSize="12" Margin="10,5,0,0" Text="{Binding Views,Converter={StaticResource KiloConverter},FallbackValue=0,Mode=OneWay}"/>
                            </StackPanel>
                        </Grid>
                    </Grid>
                </Grid>
                <Border  BorderThickness="6" Grid.RowSpan="2" Visibility="Collapsed" Windows10version1809:CornerRadius="5">
                    <Border.BorderBrush>
                        <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                            <GradientStop Offset="0" Color="#69d8ca"/>
                            <GradientStop Offset="0.5" Color="#3592ff"/>
                            <GradientStop Offset="1" Color="#9c31ff"/>
                        </LinearGradientBrush>
                    </Border.BorderBrush>
                </Border>
            </Grid>
        </DataTemplate>

        <!-- VIDEO TEMPLATE -->
        <DataTemplate x:Key="VideoTemplate" x:DataType="models:Media">
            <Grid Background="#474a51" HorizontalAlignment="Stretch" VerticalAlignment="Stretch" Windows10version1809:CornerRadius="5"  ContextRequested="Media_ContextRequested">
                <Grid.RowDefinitions>
                    <RowDefinition  />
                    <RowDefinition MaxHeight="90"  />
                </Grid.RowDefinitions>

                <!-- Loading -->
                <ProgressRing x:Name="LoadingRing" VerticalAlignment="Center" Grid.RowSpan="2" Width="50" Height="50" IsActive="True"  />
                <FontIcon  Grid.RowSpan="2" FontFamily="{StaticResource SegoeMDLGlyphs}" FontSize="25" Foreground="#01b96b"  Glyph="&#xE714;"/>

                <!-- Data Container -->
                <Grid x:Name="mediaContainer" Grid.RowSpan="2">
                    <Grid x:Name="videoPlaceholderContainer">
                        <Image x:Name="mediaPlaceholderImage" Stretch="UniformToFill" Source="{Binding CoverPlaceholder,Mode=OneWay}"/>
                        <Grid Background="Black" Opacity="1">
                            <winui:ProgressBar  x:Name="LoadingBar" VerticalAlignment="Top" MinHeight="4" IsEnabled="True" IsIndeterminate="True"  Margin="0,0,0,0" />
                        </Grid>
                    </Grid>
                    <controls:MediaElementControl Source="{Binding CoverImage,Mode=OneWay}"  />
                </Grid>
                <StackPanel x:Name="mediaInfoContainer" Orientation="Horizontal" VerticalAlignment="Top" Opacity="0.9" HorizontalAlignment="Right" Margin="15" Grid.Row="0">
                    <Grid  x:Name="VideoCountContainer" HorizontalAlignment="Right"  Margin="1,0,0,0" Background="#2e3035" Padding="5,0,5,0" Height="22" CornerRadius="3">
                        <FontIcon Margin="0,0,0,0" FontFamily="{StaticResource FluentUIGlyphs}"  FontWeight="Black" FontSize="16" Glyph="&#xE714;"/>
                    </Grid>
                    <Grid x:Name="AlbumCountContainer" HorizontalAlignment="Right"  Margin="5,0,0,0" Background="#2e3035" Padding="5,0,5,0" Height="22" CornerRadius="3" x:Load="{x:Bind IsAlbum,Mode=OneWay}">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="auto" />
                            <ColumnDefinition Width="*" />
                        </Grid.ColumnDefinitions>
                        <FontIcon Grid.Column="0" Margin="0,0,0,0" FontFamily="{StaticResource FluentUIGlyphs}"  FontWeight="Black" FontSize="16" Glyph="&#xE8B9;"/>
                        <TextBlock Grid.Column="1" TextAlignment="Center" VerticalAlignment="Center" Margin="5,-1,0,0" Text="{Binding  ImagesCount,FallbackValue=0,Mode=OneWay}" FontSize="12" FontWeight="Bold" />
                    </Grid>
                </StackPanel>
                <Grid Grid.Row="1" x:Name="MediaFooter" Background="{StaticResource AcrylicInAppFillColorDefaultBrush}"  RequestedTheme="Dark" Margin="-1" contract5Present:CornerRadius="0,0,5,5" Opacity="0.9">
                    <Grid Grid.Row="2" Margin="0,0,0,0" Padding="10">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="40"  />
                            <RowDefinition Height="*" />
                        </Grid.RowDefinitions>
                        <TextBlock Grid.Row="0" Margin="10,0,10,0" TextWrapping="Wrap" FontWeight="SemiBold" TextTrimming="CharacterEllipsis" ToolTipService.ToolTip="{Binding  Title,Mode=OneWay}"  Text="{Binding Title,FallbackValue='Image Title',Mode=OneWay }"/>
                        <Grid Grid.Row="1" >
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="*" />
                            </Grid.ColumnDefinitions>
                            <StackPanel HorizontalAlignment="Left" Margin="15,0,0,0" Grid.Column="0" Orientation="Horizontal">
                                <FontIcon FontFamily="{StaticResource FluentUIGlyphs}"  VerticalAlignment="Center" FontSize="12" Glyph="&#xE74A;"/>
                                <TextBlock FontSize="12" TextAlignment="End" Margin="10,7,0,0" Text="{Binding Ups,FallbackValue=0,Mode=OneWay}"/>
                            </StackPanel>

                            <StackPanel HorizontalAlignment="Center" Grid.Column="1" Orientation="Horizontal">
                                <FontIcon FontFamily="{StaticResource SegoeMDLGlyphs}"  VerticalAlignment="Center" FontSize="12" Glyph="&#xE90A;"/>
                                <TextBlock FontSize="12" Margin="10,5,0,0" Text="{Binding CommentCount,Converter={StaticResource KiloConverter},FallbackValue=0,Mode=OneWay}"/>
                            </StackPanel>

                            <StackPanel HorizontalAlignment="Right" Margin="0,0,15,0" Grid.Column="2" Orientation="Horizontal">
                                <FontIcon FontFamily="{StaticResource FluentUIGlyphs}"  FontSize="12" VerticalAlignment="Center" Glyph="&#xE890;"/>
                                <TextBlock FontSize="12" Margin="10,5,0,0" Text="{Binding Views,Converter={StaticResource KiloConverter},FallbackValue=0,Mode=OneWay}"/>
                            </StackPanel>
                        </Grid>
                    </Grid>
                </Grid>
                <Border  BorderThickness="6" Grid.RowSpan="2" Visibility="Collapsed" Windows10version1809:CornerRadius="5">
                    <Border.BorderBrush>
                        <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                            <GradientStop Offset="0" Color="#69d8ca"/>
                            <GradientStop Offset="0.5" Color="#3592ff"/>
                            <GradientStop Offset="1" Color="#9c31ff"/>
                        </LinearGradientBrush>
                    </Border.BorderBrush>
                </Border>
            </Grid>
        </DataTemplate>

        <!-- TEMPLATE SELECTOR -->
        <local1:MediaContainerTemplateSelector x:Key="MediaDataTemplateSelector" ImageTemplate="{StaticResource ImageTemplate}" GifTemplate="{StaticResource GifTemplate}" VideoTemplate="{StaticResource VideoTemplate}" />

        <!-- COMMAND BAR FLYOUT FOR MEDIATILE -->
        <winui:CommandBarFlyout  Placement="Left" x:Name="CommandBarFlyout1">
            <AppBarButton Label="Save"  ToolTipService.ToolTip="Save" Command="{Binding Favourite}">
                <AppBarButton.Icon>
                    <FontIcon FontFamily="{StaticResource FluentUIGlyphs}" FontSize="20" Glyph="&#xEB51;" />
                </AppBarButton.Icon>
            </AppBarButton>
            <AppBarButton Label="Share to..." ToolTipService.ToolTip="Share the content" Command="{Binding InvokeShareDialog}" >
                <AppBarButton.Icon>
                    <FontIcon FontFamily="{StaticResource SegoeMDLGlyphs}" FontSize="18" Glyph="&#xE72D;"/>
                </AppBarButton.Icon>
            </AppBarButton>
            <AppBarButton x:Uid="AppBarCopy" Label="Copy to Clipboard" ToolTipService.ToolTip="Copy the URL to Clipboard" Command="{Binding Copy}" CommandParameter="{Binding GalleryElement.Url,ElementName=GalleryDockControl}" >
                <AppBarButton.Icon>
                    <FontIcon FontFamily="{StaticResource SegoeMDLGlyphs}" FontSize="18" Glyph="&#xE8C8;"/>
                </AppBarButton.Icon>
            </AppBarButton>
            <winui:CommandBarFlyout.SecondaryCommands>
                <AppBarButton x:Uid="AppBarOpen" Label="Open Gallery" ToolTipService.ToolTip="Open Gallery" Command="{Binding NavigateMediaCommand}">
                    <AppBarButton.Icon>
                        <FontIcon FontFamily="{StaticResource FluentUIGlyphs}" FontSize="18" Glyph="&#xE927;"/>
                    </AppBarButton.Icon>
                </AppBarButton>

                <AppBarButton x:Uid="AppBarDownload" Icon="Download" Label="Download" ToolTipService.ToolTip="Download the content"></AppBarButton>
                <AppBarButton x:Uid="AppBarEmbed" Label="Embed" ToolTipService.ToolTip="Embed the content" Command="{Binding InvokeEmbedDialog}">
                    <AppBarButton.Icon>
                        <FontIcon FontFamily="{StaticResource FluentUIGlyphs}" FontSize="18" Glyph="&#xE943;"/>
                    </AppBarButton.Icon>
                </AppBarButton>
            </winui:CommandBarFlyout.SecondaryCommands>
        </winui:CommandBarFlyout>
    </UserControl.Resources>

    <toolkit:DropShadowPanel 
        x:Name="MediaElement" 
        BlurRadius="10" 
        OffsetX="0" 
        OffsetY="2" 
        ShadowOpacity="0.5" 
        HorizontalAlignment="Stretch"
        VerticalAlignment="Stretch"
        HorizontalContentAlignment="Stretch" 
        VerticalContentAlignment="Stretch"   
        Margin="6">

        <ContentControl 
            DataContext="{x:Bind ViewModel.CurrentMedia}" 
            Content="{x:Bind ViewModel.CurrentMedia,Mode=OneWay}" 
            ContentTemplateSelector="{StaticResource MediaDataTemplateSelector}" 
            ContextRequested="Media_ContextRequested"
            HorizontalContentAlignment="Stretch"
            VerticalContentAlignment="Stretch" />

        <Interactivity:Interaction.Behaviors>
            <Core:EventTriggerBehavior EventName="Tapped">
                <Core:InvokeCommandAction Command="{Binding NavigateMediaCommand}"/>
            </Core:EventTriggerBehavior>
        </Interactivity:Interaction.Behaviors>

    </toolkit:DropShadowPanel>
</UserControl>